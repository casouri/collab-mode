syntax = "proto3";

package rpc;

message Edit {
  uint64 pos = 1;
  string content = 2;
}

message Empty {}

message FatOp {
  bytes op = 1;
}

message ContextOps {
  uint32 context = 1;
  repeated bytes ops = 2;
}

message FileOps {
  uint32 doc_id = 1;
  uint32 after = 2;
}

message SnapshotChunk {
  uint32 seq = 1;
  string content = 2;
}

message DocInfo {
  uint32 doc_id = 1;
  string file_name = 2;
}

message FileList {
  repeated DocInfo files = 1;
}

message DocId {
  uint32 doc_id = 1;
}

message Credential {
  string cred = 1;
}

message SiteId {
  uint32 id = 1;
}

message FileToShare {
  string file_name = 1;
  string content = 3;
}

service DocServer {
  rpc ShareFile(FileToShare) returns (DocId);
  rpc ListFiles(Empty) returns (FileList);
  rpc SendOp(ContextOps) returns (Empty);
  rpc RecvOp(FileOps) returns (stream FatOp);
  rpc RequestFile(DocId) returns (stream SnapshotChunk);
  rpc DeleteFile(DocId) returns (Empty);
  rpc Login(Credential) returns (SiteId);
}
